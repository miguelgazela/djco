<!doctype html>
<html>
    <head>
        <meta charset="UTF-8" />
        <title>Space Invaders</title>

        <style>
            html,
            body {
                height: 100%;
                background-color: #030405;
                margin: 0;
            }

            canvas {
                margin: 0 auto;
                border-left: 2px solid #010101;
                border-right: 2px solid #010101;
            }
ยง
        </style>
    </head>
    <body>

    <script src="js/phaser.min.js"></script>
    <script src="js/gyro.min.js"></script>
    <script src="https://code.jquery.com/jquery-1.10.2.min.js"></script>

    <script>
        gyro.startTracking(function(o) {
            // o.x, o.y, o.z for accelerometer
            // o.alpha, o.beta, o.gamma for gyro
        });
    </script>

    <script src="js/game_variables.js"></script>

    <script type="text/javascript">

    window.onload = function() {

        var game = new Phaser.Game(CANVAS_WIDTH, CANVAS_HEIGHT, Phaser.AUTO, 'FEUP Invaders', { preload: preload, create: create, update: update, render: render });

        function preload () {

            loadImage(IMAGE_STARFIELD);
            loadImage(IMAGE_SHIP);
            loadImage(IMAGE_SHIP_DAMAGED);
            loadImage(IMAGE_LOGO);
            loadImage(IMAGE_P1_BULLET);
            loadImage(IMAGE_ALIEN_BULLET);
            loadImage(IMAGE_MINE);
            loadImage(IMAGE_SMALL_METEOR);
            loadImage(IMAGE_POWERUP_A);
            loadImage(IMAGE_POWERUP_B);
            loadImage(IMAGE_ALIEN_SHIP);
            loadImage(IMAGE_ASTRONAUT);
            loadImage(IMAGE_YOU_CALLOUT);


            // game.load.spritesheet('invader', 'assets/invader32x32x4.png', 32, 32);
            game.load.spritesheet('explosion', 'assets/explode.png', 128, 128);
            game.load.spritesheet(IMAGE_BTN_PLAY, 'assets/' + IMAGE_BTN_PLAY + '.png', 170, 76);
            game.load.spritesheet(IMAGE_BTN_PLAY_AGAIN, 'assets/' + IMAGE_BTN_PLAY_AGAIN + '.png', 170, 76);

            game.load.audio('s_laser', 'assets/audio/laser.wav');
            game.load.audio('s_explosion', 'assets/audio/explode.wav');

        }

        function create () {

            game.physics.startSystem(Phaser.Physics.ARCADE);

            //  The scrolling starfield background
            starfield = game.add.tileSprite(0, 0, CANVAS_WIDTH, CANVAS_HEIGHT, 'starfield');

            // Menu HUD
            hudImgLogo = game.add.sprite(0, 40, IMAGE_LOGO);
            hudImgLogo.x = game.world.centerX - hudImgLogo.width / 2;
            hudBtnPlay = game.add.button(0, 300, IMAGE_BTN_PLAY, onBtnPlay, this, 1, 0, 1);
            hudBtnPlay.x = game.world.width / 2 - hudBtnPlay.width / 2;

            hudBtnPlayAgain = game.add.button(0, 300, IMAGE_BTN_PLAY_AGAIN, onBtnPlayAgain, this, 1, 0, 1);
            hudBtnPlayAgain.x = game.world.width / 2 - hudBtnPlayAgain.width / 2;
            hudBtnPlayAgain.visible = false;
            hudBtnPlayAgain.active = false;

            hudImgYouCallout = game.add.sprite(0, 0, IMAGE_YOU_CALLOUT);
            hudImgYouCallout.anchor.setTo(0.5, 0.5);
            hudImgYouCallout.visible = false;

            //  The hero!
            player = game.add.sprite(CANVAS_WIDTH/2, CANVAS_HEIGHT - 320, 'ship');
            game.physics.enable(player, Phaser.Physics.ARCADE);
            player.anchor.setTo(0.5, 0.5);
            player.health = 100;
            player.powerUps = new Array(); /* TODO I think we'll need this later on */

            //  Our bullet group
            bulletsGroup = game.add.group();
            bulletsGroup.enableBody = true;
            bulletsGroup.physicsBodyType = Phaser.Physics.ARCADE;
            bulletsGroup.createMultiple(30, IMAGE_P1_BULLET);
            bulletsGroup.setAll('checkWorldBounds', true);
            bulletsGroup.setAll('outOfBoundsKill', true);
            bulletsGroup.setAll('anchor.x', 0.5);
            bulletsGroup.setAll('anchor.y', 1);

            //  The enemy's bullets
            alienBulletsGroup = game.add.group();
            alienBulletsGroup.enableBody = true;
            alienBulletsGroup.physicsBodyType = Phaser.Physics.ARCADE;
            alienBulletsGroup.createMultiple(15, IMAGE_ALIEN_BULLET);
            alienBulletsGroup.setAll('anchor.x', 0.5);
            alienBulletsGroup.setAll('anchor.y', 1);
            alienBulletsGroup.setAll('checkWorldBounds', true);
            alienBulletsGroup.setAll('outOfBoundsKill', true);

            //  Our mines group
            minesGroup = game.add.group();
            minesGroup.enableBody = true;
            minesGroup.physicsBodyType = Phaser.Physics.ARCADE;
            minesGroup.setAll('anchor.x', 0.5);
            minesGroup.setAll('anchor.y', 0.5);
            minesGroup.setAll('checkWorldBounds', true);
            minesGroup.setAll('outOfBoundsKill', true);

            //  group of meteors
            meteorsGroup = game.add.group();
            meteorsGroup.enableBody = true;
            meteorsGroup.physicsBodyType = Phaser.Physics.ARCADE;
            meteorsGroup.createMultiple(30, IMAGE_SMALL_METEOR);
            meteorsGroup.setAll('anchor.x', 0.5);
            meteorsGroup.setAll('anchor.y', 1);
            meteorsGroup.setAll('checkWorldBounds', true);
            meteorsGroup.setAll('outOfBoundsKill', true);
            meteorsGroup.setAll('body.bounce.x', 1);
            meteorsGroup.setAll('body.bounce.y', 1);
            meteorsGroup.setAll('body.minBounceVelocity', 0);

            //  The enemies
            aliensGroup = game.add.group();
            aliensGroup.enableBody = true;
            aliensGroup.physicsBodyType = Phaser.Physics.ARCADE;
            createAliens();

            // pickups pool
            pickupGroup = game.add.group();
            /* TODO RC */
            pickupGroup.enableBody = true;
            pickupGroup.physicsBodyType = Phaser.Physics.ARCADE;

            //  Explosion pool
            explosionsGroup = game.add.group();
            explosionsGroup.createMultiple(10, 'explosion');
            explosionsGroup.setAll('anchor.x', 0.5);
            explosionsGroup.setAll('anchor.y', 0.5);
            explosionsGroup.forEach(function(explosion) { explosion.animations.add('explosion'); }, this);


            //  Controls to play the game
            cursors = game.input.keyboard.createCursorKeys();
            dropMineButton = game.input.keyboard.addKey(Phaser.Keyboard.SHIFT);
            aliensFireButton = game.input.keyboard.addKey(Phaser.Keyboard.SPACEBAR);

            //  Game Hud
            var style = { fontSize: '26px', fill: '#e9e9e9' };
            var style2 = { fontSize: '16px', fill: '#e9e9e9' };
            hudTxtScore = game.add.text(10, 10, "Score: " + score, style);
            hudTxtScore.visible = false;

            hudTxtHealth = game.add.text(800, 10, "Health: " + player.health, style);
            hudTxtHealth.visible = false;

            hudTxtMines = game.add.text(10, 36, "Mines: ", {fontSize: '26px', fill: '#e9e9e9'});
            hudTxtMines.visible = false;

            /* TODO RC */
            /* Powerups HUD - initially not visible. Picking up a power-up will make it visible in the HUD info */
            hudTxtPowerupB = game.add.text(800, 70, "PB", {fontSize: '10px', fill: '#e9e9e9'}); // TODO Why doesn't fontsize actually change the fontsize?
            hudTxtPowerupB.visible = false;

            for(var i = 0; i < numberMines; i++) {
                var mine = minesGroup.create(110 + i * 20, 53, IMAGE_MINE);
                mine.anchor.setTo(0.5, 0.5);
                mine.alpha = 0.7;
            }
            minesGroup.setAll('visible', false);

            healthBar = new Phaser.Rectangle(HEALTH_BAR_X, HEALTH_BAR_Y, 144, 10);
            gunHeatBackgroundBar = new Phaser.Rectangle(GUN_HEAT_BAR_BG_X, GUN_HEAT_BAR_BG_Y, 102, 10);
            gunHeatBar = new Phaser.Rectangle(GUN_HEAT_BAR_X, GUN_HEAT_BAR_Y, 6, 6);

            // sounds
            s_laser = game.add.audio('s_laser');
            s_explosion = game.add.audio('s_explosion');

            gameState = GAMESTATE_NOTSTARTED;
        }

        function update () {

            if (gameState == GAMESTATE_PLAYING) {

                //  Scroll the background
                starfield.tilePosition.y += backgroundScrollSpeed * GAME_SPEED_QF;
                backgroundScrollSpeed += speedInc;

                processInput();

                // decrease gun heat
                gunHeat = Math.max(6, gunHeat - (0.4 * GAME_SPEED_QF));
                updateHeatBar();

                if (game.time.now > meteorTimer) {
                    sendMeteor();
                }

                // //  Check collisions
                game.physics.arcade.overlap(alienBulletsGroup, player, onAlienHitsPlayer, null, this);
                game.physics.arcade.overlap(alienBulletsGroup, meteorsGroup, onAlienBulletsHitMeteors, null, this);
                game.physics.arcade.overlap(meteorsGroup, player, onMeteorHitsPlayer, null, this);
                game.physics.arcade.overlap(bulletsGroup, meteorsGroup, onPlayerBulletsHitMeteors, null, this);
                game.physics.arcade.overlap(aliensGroup, meteorsGroup, onMeteorHitsAlien, null, this);
                game.physics.arcade.overlap(pickupGroup, player, onPickupOverlap, null, this);
                game.physics.arcade.overlap(minesGroup, aliensGroup, onMineHitsAlien, null, this);

                // game.physics.overlap(alienBulletsGroup, meteors, onPlayerBulletsHitMeteors, null, this);

                // game.physics.arcade.collide(meteorsGroup);
            }

            if (gameState == GAMESTATE_DIED || gameState == GAMESTATE_GAMEOVER) {
                positionYouCalloutOnAstronaut();
            }

        }

        function processInput() {

            //  Reset P1, then check the movement keys
            player.body.velocity.setTo(0, 0);

            if (cursors.left.isDown) {
                player.body.velocity.x = -200;
                player.angle = -15;

                if (cursors.up.isDown) {
                    player.body.velocity.y = -200;

                } else if (cursors.down.isDown) {
                    if (player.y < BOTTOM_LIMIT) {
                        player.body.velocity.y = 200;
                    }
                }
            } else if (cursors.right.isDown) {
                player.body.velocity.x = 200;
                player.angle = 15;

                if (cursors.up.isDown) {
                    player.body.velocity.y = -200;
                } else if (cursors.down.isDown) {
                    if (player.y < BOTTOM_LIMIT) {
                        player.body.velocity.y = 200;
                    }
                }
            } else if (cursors.up.isDown) {
                player.body.velocity.y = -200;
                player.angle = 0;
            } else if (cursors.down.isDown) {
                player.angle = 0;
                if (player.y < BOTTOM_LIMIT) {
                    player.body.velocity.y = 200;
                }
            } else {
                player.angle = 0;
            }

            player.body.velocity.x *= GAME_SPEED_QF;
            player.body.velocity.y *= GAME_SPEED_QF;

            //  Check if hero has moved to the other side
            if ((player.body.x + (PLAYER_SHIP_WIDTH / 2) - 2) < 0) {
                player.body.x = CANVAS_WIDTH + (PLAYER_SHIP_WIDTH / 2) - 2;  //  -2 just to see the tip of the wing
            }  
            else if ((player.body.x - (PLAYER_SHIP_WIDTH / 2) + 2) > CANVAS_WIDTH) {
                player.body.x = 0 - (PLAYER_SHIP_WIDTH / 2) + 2;  //  + 2 just to see the tip of the wing
            }

            // Check if P1 is firing
            if (game.input.mousePointer.isDown) {
                fireBullet();
            }

            //  Check if it's dropping a mine
            if (dropMineButton.isDown) {
                dropMine();
            }

            aliensGroup.setAll('body.velocity.x', 0);
            var atTheEdge = false;
            var velocity = 0;

            if (game.input.keyboard.isDown(Phaser.Keyboard.A)) {
                aliensGroup.forEachAlive(function(child, index) {
                    if ( (child.body.x + aliensGroup.x) - 16 < 1) {
                        atTheEdge = true;
                    }
                });
                velocity = -200 * GAME_SPEED_QF;
                
            } else if (game.input.keyboard.isDown(Phaser.Keyboard.D)) {
                aliensGroup.forEachAlive(function(child, index) {
                    if ( (child.body.x + aliensGroup.x) + 16 > CANVAS_WIDTH - 1) {
                        atTheEdge = true;
                    }
                });
                velocity = 200 * GAME_SPEED_QF;
            }

            if(!atTheEdge) {
                aliensGroup.setAll('body.velocity.x', velocity);
            }

            if(aliensFireButton.isDown) {
                alienFire();
            }

        }

        function render () {

            if (gameState == GAMESTATE_PLAYING) {
                var healthBarColor = "#2ecc71";
                if (player.health < 30) {
                    healthBarColor = "#c0392b";
                } else if (player.health < 75) {
                    healthBarColor = "#f1c40f";
                }

                game.debug.geom(healthBar, healthBarColor);

                var gunHeatBarColor = "#2ecc71";
                if ( gunHeat > 80 ) {
                    gunHeatBarColor = "#c0392b";
                } else if ( gunHeat > 40 ) {
                    gunHeatBarColor = "#f1c40f";
                }
                game.debug.geom(gunHeatBackgroundBar, "#ddd");
                game.debug.geom(gunHeatBar, gunHeatBarColor);

                // game.debug.bodyInfo(player, 32, 320);
                // game.debug.spriteBounds(player);
                // meteorsGroup.children.forEach(function(child, index) {
                //     if (index < 2 && child.alive) {
                //         game.debug.spriteBounds(child);
                //     }
                // });
                // aliensGroup.children.forEach(function(child, index) {
                //     if (index < 5 && child.alive) {
                //         game.debug.spriteBounds(child);
                //     }
                // });
            }
            

        }

        // ------------------------------------------------------------------------------------------------
        // ------------------------------------------------------------------------------------------------
        //  
        //                                          COLLISIONS CALLBACKS
        // 
        // ------------------------------------------------------------------------------------------------
        // ------------------------------------------------------------------------------------------------

        function onPlayerBulletsHitMeteors (bullet, meteor) {

            bulletHitsMeteor(bullet, meteor);

            // update player score
            score += 5;
            hudTxtScore.text = "Score: " + score;

        }

        function onMineHitsAlien (mine, alien) {

            mine.kill();
            alien.kill();
            createExplosion(alien.body.x, alien.body.y);

            //  Increase the score
            score += 20;
            hudTxtScore.content = "Score: " + score;

        }

        function onAlienBulletsHitMeteors (bullet, meteor) {
            bulletHitsMeteor(bullet, meteor);
        }

        function onAlienHitsPlayer (player, bullet) {

            bullet.kill();
            createExplosion(player.body.x, player.body.y);

            // decrease player's health
            damagePlayer(20);
        }

        function onMeteorHitsPlayer (player, meteor) {

            meteor.kill();
            createExplosion(player.body.x, player.body.y);

            // decrease player's health
            damagePlayer(10);
        }

        function onMeteorHitsAlien (alien, meteor) {
            meteor.kill();
            //alien.kill();
        }

        function onPickupOverlap (player, pickup) {

            switch(pickup.type) {
                case "power_up_A":
                    //hudTxtPowerupA.visible = true;
                    pickup.kill();
                    healPlayer(10);

                    //TODO start a countdown for the powerup duration, if that is the case
                    //TODO do powerup action
                break;
                case "power_up_B":
                    hudTxtPowerupB.visible = true; /* TODO can eventually disappear if this isn't a timed powerup */
                    pickup.kill();
                    //TODO start a countdown for the powerup duration, if that is the case
                    //TODO do powerup action
                break;
                default: //unexpected stuff happened
            }
        }

        // ------------------------------------------------------------------------------------------------
        // ------------------------------------------------------------------------------------------------
        //  
        //                               COLLISIONS CALLBACKS AUXILIARY FUNCTIONS
        // 
        // ------------------------------------------------------------------------------------------------
        // ------------------------------------------------------------------------------------------------

        function bulletHitsMeteor(bullet, meteor) {
            bullet.kill();
            meteor.kill();

            createExplosion(bullet.body.x, bullet.body.y - bullet.height);
            maybeDropPickup(meteor.body.x, meteor.body.y);
        }

        function damagePlayer(damage) {

            if(player.health === 100) {
                player.loadTexture(IMAGE_SHIP_DAMAGED);
            }

            player.damage(damage);

            // update health HUD
            hudTxtHealth.text = "Health: " + player.health;
            updateDamageHealthBar();

            if (!player.alive) {
               playerOneDied();
            }
        }

        /* TODO RC */
        function healPlayer(health) {

            if(player.health < 100) { // if the player has taken some damage

                if(player.health + health >= 100)  // if the healing is more then enough to fully restore the ship
                    player.health = 100;
                else player.health += health; 

                if(player.health === 100) { //if the player is restored to max health, restore the good ship texture
                    player.loadTexture(IMAGE_SHIP);
                }

                // update health HUD
                hudTxtHealth.text = "Health: " + player.health;
                updateHealHealthBar();

                if (!player.alive) {
                   playerOneDied();
                }
            }   
        }

        function maybeDropPickup(x, y) {

            if(game.rnd.frac() <= PICKUP_DROP_CHANGE && gameState === GAMESTATE_PLAYING) {
                var pickupType;
                var random = game.rnd.frac();

                if (random <= 0.5) {
                    pickupType = IMAGE_POWERUP_A;
                } else {
                    pickupType = IMAGE_POWERUP_B;
                }

                dropPickup(x, y, pickupType);
            }
        }

        // ------------------------------------------------------------------------------------------------
        // ------------------------------------------------------------------------------------------------
        //  
        //                                    Gamestate related functions
        // 
        // ------------------------------------------------------------------------------------------------
        // ------------------------------------------------------------------------------------------------

        function onBtnPlay() {

            hudBtnPlay.visible = false;
            hudBtnPlay.active = false;
            hudTxtScore.visible = true;
            hudTxtHealth.visible = true;
            hudTxtMines.visible = true;
            minesGroup.setAll('visible', true);

            if (playedOnce) {
                hudImgLogo.visible = false;
            } else {
                var tween = game.add.tween(hudImgLogo).to({alpha: 0}, 200, Phaser.Easing.Linear.None, true, 0, 0, false);
                tween.onComplete.add(function() {
                    hudImgLogo.visible = false;
                });
            }

            gameState = GAMESTATE_PLAYING;

        }

        function playerOneDied() {

            hudTxtScore.visible = false;
            hudTxtHealth.visible = false;
            playedOnce = true;

            astronaut = game.add.sprite(player.body.x, player.body.y, IMAGE_ASTRONAUT);
            game.physics.enable(astronaut, Phaser.Physics.ARCADE);
            astronaut.anchor.setTo(0.5, 0.5);
            astronaut.body.velocity.x = game.rnd.integerInRange(-20, 20);
            astronaut.body.velocity.y = game.rnd.integerInRange(-20, 20);
            astronaut.body.angularVelocity = 40;

            hudImgYouCallout.visible = true;
            positionYouCalloutOnAstronaut();

            game.time.events.add(Phaser.Timer.SECOND * 3, gameOver, this);

            gameState = GAMESTATE_DIED;
        }

        function gameOver() {
            hudBtnPlayAgain.alpha = 0;
            hudBtnPlayAgain.visible = true;

            var tweenB = game.add.tween(hudBtnPlayAgain).to({alpha: 1}, 300, Phaser.Easing.Linear.None, true, 0, 0, false);
            tweenB.onComplete.add(function() {
                hudBtnPlayAgain.active = true;
            })

            gameState = GAMESTATE_GAMEOVER;
        }

        function onBtnPlayAgain() {

        }

        // ------------------------------------------------------------------------------------------------
        // ------------------------------------------------------------------------------------------------
        //  
        //                                          Custom functions
        // 
        // ------------------------------------------------------------------------------------------------
        // ------------------------------------------------------------------------------------------------

        function alienFire () {

            if (game.time.now > firingTimer) {
                enemyBullet = alienBulletsGroup.getFirstExists(false);
                livingEnemies.length = 0;

                aliensGroup.forEachAlive(function (alien) {
                    livingEnemies.push(alien);
                });

                if (enemyBullet && livingEnemies.length > 0) {
                    var random = game.rnd.integerInRange(0, livingEnemies.length - 1);

                    var shooter = livingEnemies[random];
                    enemyBullet.reset(shooter.body.x, shooter.body.y);

                    game.physics.arcade.moveToObject(enemyBullet, player, 120);
                    firingTimer = game.time.now + 1000;
                }
            }
        }

        function sendMeteor () {

            var randomX = game.rnd.integerInRange(0, CANVAS_WIDTH);
            meteor = meteorsGroup.getFirstExists(false);

            if (meteor) {
                meteor.reset(randomX, -21);
                meteor.body.velocity.y = game.rnd.integerInRange(50, 200);
                meteor.body.velocity.x = game.rnd.integerInRange(-50, 50);
                // meteor.body.angularVelocity = 10;
                // meteor.body.rotation = game.rnd.integerInRange(1, 20);
                meteorTimer = game.time.now + (400 / GAME_SPEED_QF);
            }

        }

        function dropPickup(x, y, pickupType) {

            var pickup = pickupGroup.create(0, 0, pickupType);
            pickup.anchor.setTo(0.5, 0.5);
            pickup.reset(x, y);
            pickup.type = pickupType;

            game.time.events.add(Phaser.Timer.SECOND * PICKUP_DESPAWN_RATE, function() {
                pickup.kill();
            }, this);

        }

        function createAliens () {

            var NUM_COL = 5;
            var DIST_BETWEEN = 140;

            var START_POS = (CANVAS_WIDTH - (NUM_COL * ALIEN_SHIP_WIDTH + (NUM_COL - 1) * (DIST_BETWEEN - ALIEN_SHIP_WIDTH))) / 2 + (ALIEN_SHIP_WIDTH / 2);

            for (var y = 0; y < 4; y++) {
                for (var x = 0; x < NUM_COL; x++) {
                        var alien = aliensGroup.create(START_POS + x * DIST_BETWEEN, (CANVAS_HEIGHT - 200) + 16 + y * 50, IMAGE_ALIEN_SHIP);
                    
                    alien.anchor.setTo(0.5, 0.5);
                    // alien.animations.add('fly', [0, 1, 2, 3], 20, true);
                    // alien.play('fly');
                }
            }

            // aliens.x = (CANVAS_WIDTH - (NUM_COL * ALIEN_SHIP_WIDTH + (NUM_COL - 1) * (DIST_BETWEEN - ALIEN_SHIP_WIDTH))) / 2 + (ALIEN_SHIP_WIDTH / 2);
            // aliens.y = CANVAS_HEIGHT - 200;

            // var tween = game.add.tween(aliens).to( {x: 130}, 1000, Phaser.Easing.Linear.None, true, 0, 1000, true);
            // tween.onComplete.add(function () { aliens.y += 10; }, this);

        }

        function fireBullet () {

            //  To avoid them being allowed to fire too fast we set a time limit
            if (game.time.now > bulletTime && game.time.now > gunCooldown) {
                //  Grab the first bullet we can from the pool
                bullet = bulletsGroup.getFirstExists(false);

                if (bullet) {

                    //  And fire it
                    bullet.reset(player.x, player.y + 8);
                    bullet.body.velocity.y = -400 * GAME_SPEED_QF;
                    bulletTime = game.time.now + (200 / GAME_SPEED_QF);
                    // s_laser.play();

                    // add heat to gun
                    gunHeat = Math.min(gunHeat + 15, 100);
                    updateHeatBar();
                    if (gunHeat === 100) {
                        gunCooldown = game.time.now + (3000 * GAME_SPEED_QF); // if weapons gets too hot, needs to wait 3 seconds
                    }
                }
            }

        }

        function dropMine () {

            if (game.time.now > mineTime && numberMines > 0) {

                mine = minesGroup.getAt(numberMines - 1);

                if (mine) {
                    numberMines -= 1;
                    mine.reset(player.x, player.y + 12);
                    mine.body.velocity.y = 100;
                    mineTime = game.time.now + (400 / GAME_SPEED_QF);
                }
            }

        }

        function updateHeatBar () {
            gunHeatBar.setTo(GUN_HEAT_BAR_X, GUN_HEAT_BAR_Y, gunHeat, 6 * GAME_SPEED_QF);
        }

        function updateDamageHealthBar () {
            healthBar.setTo(HEALTH_BAR_X, HEALTH_BAR_Y, healthBar.width - 14.4, healthBar.height);
        }

        /* TODO RC */
        function updateHealHealthBar () {

            healthBar.setTo(HEALTH_BAR_X, HEALTH_BAR_Y, healthBar.width + 14.4, healthBar.height);
        }

        

        function positionYouCalloutOnAstronaut() {
            hudImgYouCallout.x = astronaut.x;
            hudImgYouCallout.y = astronaut.y - 20;
        }

        function createExplosion(x, y) {

            // s_explosion.play();
            var explosion = explosionsGroup.getFirstDead();
            explosion.reset(x, y);
            explosion.play('explosion', 30, false, true);

        }

        function loadImage(image) {
            game.load.image(image, 'assets/' + image + '.png');
        }

    };

    </script>

    </body>
</html>